<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Blockly Demo: Fixed Blockly</title>
  <script src="../../blockly_uncompressed.js"></script>
  <script src="../../blocks_compressed.js"></script>
  <script src="../../robMsg/robMessages.js"></script>
  <script src="../../msg/js/en.js"></script>

  <!-- <script src="../../core/mutatorPlus.js"></script> -->
  <!-- <script src="../../core/mutatorMinus.js"></script> -->
  <!-- <script src="../../msg/js/en.js"></script> -->
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
  </style>
</head>
<body>
  <h1><a href="https://developers.google.com/blockly/">Blockly</a> &gt;
    <a href="../index.html">Demos</a> &gt; Fixed Blockly</h1>

  <p>This is a simple demo of injecting Blockly into a fixed-sized 'div' element.</p>

  <p>&rarr; More info on <a href="https://developers.google.com/blockly/guides/configure-blockly/web/fixed-size">injecting fixed-sized Blockly</a>&hellip;</p>

  <div id="blocklyDiv" style="height: 480px; width: 600px;"></div>

  <xml id="toolbox" style="display: none">
    <block type="property_value"></block>
    <block type="string_value"></block>
    <block type="asset_id"></block>
    <block type="number"></block>
    <block type="concat_array"></block>
    <block type="concat_values"></block>
    <block type="substitute"></block>
  </xml>

  <script>
    Blockly.defineBlocksWithJsonArray(
      [{
        "type": "property_value",
        "lastDummyAlign0": "RIGHT",
        "message0": "Value of %1 %2",
        "args0": [
          {
            "type": "input_dummy"
          },
          {
            "type": "field_dropdown",
            "name": "Hello",
            "options": [
              [
                "option",
                "OPTIONNAME"
              ],
              [
                "option",
                "OPTIONNAME"
              ],
              [
                "option",
                "OPTIONNAME"
              ]
            ]
          }
        ],
        "inputsInline": true,
        "output": "String",
        "colour": "#94AAD6",
        "tooltip": "Hello",
        "helpUrl": ""
      },
      {
        "type": "string_value",
        "lastDummyAlign0": "RIGHT",
        "message0": "%1",
        "args0": [
          {
            "type": "field_input",
            "name": "string",
            "text": "Enter value"
          }
        ],
        "inputsInline": true,
        "output": "String",
        "colour": "#94AAD6",
        "tooltip": "Hello",
        "helpUrl": ""
      },
      {
        "type": "number",
        "message0": "Numbers %1 %2",
        "args0": [
          {
            "type": "input_dummy"
          },
          {
            "type": "field_number",
            "name": "number",
            "value": 0
          }
        ],
        "inputsInline": true,
        "output": "Number",
        "colour": "#94AAD6",
        "tooltip": "",
        "helpUrl": ""
      },
      {
        "type": "asset_id",
        "lastDummyAlign0": "RIGHT",
        "message0": "Asset %1 %2",
        "args0": [
          {
            "type": "input_dummy"
          },
          {
            "type": "field_dropdown",
            "name": "NAME",
            "options": [
              [
                "option",
                "OPTIONNAME"
              ],
              [
                "option",
                "OPTIONNAME"
              ],
              [
                "option",
                "OPTIONNAME"
              ]
            ]
          }
        ],
        "inputsInline": true,
        "output": "String",
        "colour": "#94AAD6",
        "tooltip": "",
        "helpUrl": ""
      },
      {
        "type": "substitute",
        "message0": "Substitute %1 %2 in %3 %4",
        "args0": [
          {
            "type": "input_dummy"
          },
          {
            "type": "input_value",
            "name": "value_to_substitute",
            "check": [
              "String",
              "Number"
            ]
          },
          {
            "type": "input_dummy"
          },
          {
            "type": "input_value",
            "name": "value",
            "check": "String"
          }
        ],
        "inputsInline": true,
        "output": "String",
        "colour": "#94AAD6",
        "tooltip": "",
        "helpUrl": ""
      }]
    );

    Blockly.Blocks['concat_array'] = {
      /**
       * Block for creating a list with any number of elements of any type.
       *
       * @this Blockly.Block
       */
      init : function() {
          this.setColour("#94AAD6");

          this.appendValueInput('ADD0').appendField(Blockly.Msg.LISTS_CREATE_TITLE)
          this.setInputsInline(false);
          this.appendValueInput('ADD1');
          this.setOutput(true, 'Array_String');
          this.setMutatorPlus(new Blockly.MutatorPlus(this));
          this.setMutatorMinus(new Blockly.MutatorMinus(this));
          this.setTooltip(Blockly.Msg.LISTS_CREATE_WITH_TOOLTIP);
          this.itemCount_ = 2;
      },
      /**
       * Create XML to represent list inputs.
       *
       * @return {Element} XML storage element.
       * @this Blockly.Block
       */
      mutationToDom : function() {
          var container = document.createElement('mutation');
          container.setAttribute('items', this.itemCount_);
          return container;
      },
      /**
       * Parse XML to restore the list inputs.
       *
       * @param {!Element}
       *            xmlElement XML storage element.
       * @this Blockly.Block
       */
      domToMutation : function(xmlElement) {
          for (var x = 0; x < this.itemCount_; x++) {
              this.removeInput('ADD' + x);
          }
          this.itemCount_ = parseInt(xmlElement.getAttribute('items'), 10);

          this.itemCount_ = parseInt(xmlElement.getAttribute('items'), 10);
          for (var x = 0; x < this.itemCount_; x++) {
              if (x == 0) {
                  this.appendValueInput('ADD0').appendField(Blockly.Msg.LISTS_CREATE_TITLE);
                  this.setInputsInline(false);
              } else {
                  this.appendValueInput('ADD' + x)
              }
          }
          if (this.itemCount_ == 0) {
              this.appendDummyInput('EMPTY').appendField(Blockly.Msg.LISTS_CREATE_EMPTY_TITLE);
              this.mutatorMinus.dispose();
              this.mutatorMinus = null;
          } else {
              this.setMutatorMinus(new Blockly.MutatorMinus(this));
          }
      },

      /**
       * Update the shape according to the number of item inputs.
       *
       * @param {Number}
       *            number of item inputs.
       * @this Blockly.Block
       */
      updateShape_ : function(num) {
          Blockly.dragMode_ = Blockly.DRAG_NONE;

          if (num == 1) {
              if (this.itemCount_ == 0) {
                  this.removeInput('EMPTY');
                  this.appendValueInput('ADD0').appendField(Blockly.Msg.LISTS_CREATE_TITLE);
                  this.setInputsInline(false);
                  this.setMutatorMinus(new Blockly.MutatorMinus(this));
              } else {
                  this.appendValueInput('ADD' + this.itemCount_)
              }

              this.itemCount_++;
          } else if (num == -1) {
              this.itemCount_--;
              var target = this.getInputTargetBlock('ADD' + this.itemCount_);
              if (target) {
                  target.unplug();
                  target.dispose();
              }
              this.removeInput('ADD' + this.itemCount_);
          }
          if (this.itemCount_ == 0) {
              this.appendDummyInput('EMPTY').appendField(Blockly.Msg.LISTS_CREATE_EMPTY_TITLE);
              this.mutatorMinus.dispose();
              this.mutatorMinus = null;
          }
          this.render();
      }
    }

    Blockly.Blocks['concat_values'] = {
      /**
       * Block for creating a list with any number of elements of any type.
       *
       * @this Blockly.Block
       */
      init : function() {
          this.setColour("#94AAD6");

          this.appendValueInput('ADD0').appendField('Combine values')
          this.setInputsInline(false);
          this.appendValueInput('ADD1');
          this.setOutput(true, 'Array_String');
          this.setMutatorPlus(new Blockly.MutatorPlus(this));
          this.setMutatorMinus(new Blockly.MutatorMinus(this));
          this.setTooltip(Blockly.Msg.LISTS_CREATE_WITH_TOOLTIP);
          this.itemCount_ = 2;
      },
      /**
       * Create XML to represent list inputs.
       *
       * @return {Element} XML storage element.
       * @this Blockly.Block
       */
      mutationToDom : function() {
          var container = document.createElement('mutation');
          container.setAttribute('items', this.itemCount_);
          return container;
      },
      /**
       * Parse XML to restore the list inputs.
       *
       * @param {!Element}
       *            xmlElement XML storage element.
       * @this Blockly.Block
       */
      domToMutation : function(xmlElement) {
          for (var x = 0; x < this.itemCount_; x++) {
              this.removeInput('ADD' + x);
          }
          this.itemCount_ = parseInt(xmlElement.getAttribute('items'), 10);

          this.itemCount_ = parseInt(xmlElement.getAttribute('items'), 10);
          for (var x = 0; x < this.itemCount_; x++) {
              if (x == 0) {
                  this.appendValueInput('ADD0').appendField('Combine values');
                  this.setInputsInline(false);
              } else {
                  this.appendValueInput('ADD' + x)
              }
          }
          if (this.itemCount_ == 0) {
              this.appendDummyInput('EMPTY').appendField("Combine values");
              this.mutatorMinus.dispose();
              this.mutatorMinus = null;
          } else {
              this.setMutatorMinus(new Blockly.MutatorMinus(this));
          }
      },

      /**
       * Update the shape according to the number of item inputs.
       *
       * @param {Number}
       *            number of item inputs.
       * @this Blockly.Block
       */
      updateShape_ : function(num) {
          Blockly.dragMode_ = Blockly.DRAG_NONE;

          if (num == 1) {
              if (this.itemCount_ == 0) {
                  this.removeInput('EMPTY');
                  this.appendValueInput('ADD0').appendField('Combine values');
                  this.setInputsInline(false);
                  this.setMutatorMinus(new Blockly.MutatorMinus(this));
              } else {
                  this.appendValueInput('ADD' + this.itemCount_)
              }

              this.itemCount_++;
          } else if (num == -1) {
              this.itemCount_--;
              var target = this.getInputTargetBlock('ADD' + this.itemCount_);
              if (target) {
                  target.unplug();
                  target.dispose();
              }
              this.removeInput('ADD' + this.itemCount_);
          }
          if (this.itemCount_ == 0) {
              this.appendDummyInput('EMPTY').appendField("Combine values");
              this.mutatorMinus.dispose();
              this.mutatorMinus = null;
          }
          this.render();
      }
    }

    var demoWorkspace = Blockly.inject('blocklyDiv', {
      media: '../../media/',
      toolbox: document.getElementById('toolbox')
    });
  </script>

</body>
</html>
